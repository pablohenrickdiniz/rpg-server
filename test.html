<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css"/>
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="bower_components/moment/min/moment-with-locales.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-validation/dist/jquery.validate.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-validation/dist/additional-methods.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            moment.locale('pt-br        ');
            $("#delete").click(function(){
                var controllers = [
                    'users'
                ];

               controllers.forEach(function(controller){
                    $.ajax({
                        url:'http://localhost:9090/'+controller,
                        type:'delete',
                        data:{
                            id:'345'
                        },
                        success:function(data){
                            console.log(data);
                        }
                    });
                });

            });

            $.validator.addMethod(
                    "regex",
                    function(value, element, regexp) {
                        return this.optional(element) || regexp.test(value);
                    },
                    "Please check your input."
            );



            $('#add-user').validate({
                rules:{
                    'profile.fullname':{
                        required:true
                    },
                    'profile.birthdate':{
                        required:true,
                        regex:/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/
                    }
                },
                messages:{
                    'profile.fullname':{
                        required:'O nome completo deve ser preenchido'
                    },
                    'profile.birthdate':{
                        required:'A data de nascimento deve ser preenchida',
                        date:'Essa data é inválida'
                    }
                },
                submitHandler:function(){
                    var validator = this;
                    var self = $('#add-user');
                    var data = $(self).serializeArray();
                    data = data.reduce(function(obj,item){
                        obj[item.name] = item.value;
                        return obj;
                    },{});
                    var method = $(self).prop('method');
                    var action = $(self).prop('action');
                    $.ajax({
                        url:action,
                        method:method,
                        data:data,
                        dataType:'json',
                        success:function(data){
                            if(data.success){

                            }
                            else{
                                var errors = {};
                                Object.keys(data).forEach(function(key){
                                    errors[key] = data[key].message;
                                });
                                validator.showErrors(errors);
                            }
                        },
                        error:function(data){

                        }
                    });
                }
            });
        });
    </script>
</head>
<body>
<div class="container">
    <form action="http://localhost:9090/users" method="post" id="add-user">
        <div class="form-group">
            <label for="">Nome Completo</label>
            <input type="text" class="form-control" name="profile.fullname"/>
        </div>
        <div class="form-group">
            <label for="">Data Nascimento</label>
            <input type="text" class="form-control" name="profile.birthdate"/>
        </div>
        <div class="form-group">
            <label for="">Nome de usuário</label>
            <input type="text" class="form-control" name="username"/>
        </div>
        <div class="form-group">
            <label for="">Email</label>
            <input type="email" class="form-control" name="profile.email"/>
        </div>
        <div class="form-group">
            <label for="">Senha</label>
            <input type="password" class="form-control" name="password"/>
        </div>
        <button type="submit">Cadastrar</button>
    </form>
    <button type="button" id="delete">Delete</button>
</div>
</body>
</html>